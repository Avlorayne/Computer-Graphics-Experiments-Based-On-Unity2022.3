# Unity 2D图形学实验系统设计文档

## 1. 需求文档

### 简介

本文档规定了使用Unity引擎构建的2D图形学实验系统的需求。该系统在Unity的正交2D视图中实现交互式多边形绘制、几何变换以及矩形区域内直线和多边形的高级裁剪算法。系统专注于图形学原理的实现，避免使用Unity内置的Graphics类，而是基于像素级操作实现算法。

### 术语表

- **图形学实验系统**: 用于学习和验证图形学算法的Unity应用程序
- **正交2D视图**: Unity中使用的二维投影视图，提供无透视的平面绘图环境
- **FrameBuffer**: 自定义帧缓冲，模拟传统图形API的绘图表面
- **绘制管线**: 从CPU到GPU的数据处理和渲染流程
- **Unity UI系统**: Unity的即时模式GUI和Canvas系统，用于构建用户界面
- **Scriptable Renderer**: Unity可编程渲染管线，允许自定义渲染逻辑
- **多边形**: 由连接线段组成的封闭几何图形
- **变换**: 修改几何对象位置、大小或方向的数学运算
- **裁剪**: 移除几何对象中位于指定矩形区域外部分的过程
- **Cohen-Sutherland算法**: 使用区域编码高效地对矩形窗口内直线进行裁剪的算法
- **中点分割算法**: 递归细分直线以确定可见部分的直线裁剪算法
- **Sutherland-Hodgman算法**: 依次对裁剪窗口的每条边进行多边形裁剪的算法
- **Weiler-Atherton算法**: 处理复杂情况（包括孔洞和多重交点）的多边形裁剪算法
- **菜单项**: 应用程序菜单栏中的用户界面元素
- **工具栏按钮**: 应用程序工具栏中的用户界面元素

### 需求

#### 需求1: 多边形绘制

**用户故事：** 作为学生/研究者，我希望能够用鼠标交互式地绘制多边形，以便创建自定义几何形状进行图形学实验。

##### 验收标准

1. 当用户从Unity UI菜单或工具栏选择多边形绘制工具时，系统应进入多边形绘制模式
2. 当用户在多边形绘制模式下点击鼠标时，系统应在点击的世界坐标位置添加一个顶点
3. 当用户在多边形绘制过程中双击或右键点击时，系统应闭合当前多边形并完成绘制操作
4. 当正在绘制多边形时，系统应显示连接当前鼠标位置与最后一个顶点的临时线段
5. 当多边形完成时，系统应渲染具有可见边缘的多边形并将其存储在图形场景中

#### 需求2: 几何变换

**用户故事：** 作为学生/研究者，我希望能够对选中的图形对象进行平移、缩放和旋转变换，以便验证图形变换算法的正确性。

##### 验收标准

1. 当用户点击图形对象时，系统应选中该对象并提供表示选中状态的视觉反馈
2. 当用户选择平移工具并拖拽选中对象时，系统应应用平移变换，对象跟随鼠标移动
3. 当用户选择缩放工具并从选中对象拖拽时，系统应根据鼠标距离对象中心的距离按比例调整对象大小
4. 当用户选择旋转工具并通过鼠标点击指定旋转点时，系统应根据鼠标移动围绕指定点旋转选中对象
5. 当执行变换操作时，系统应立即更新对象坐标并重绘场景

#### 需求3: 直线裁剪

**用户故事：** 作为学生/研究者，我希望能够使用不同算法在矩形区域内裁剪直线，以便验证和比较各种直线裁剪算法的效果。

##### 验收标准

1. 当用户选择直线裁剪工具时，系统应允许用户通过鼠标拖拽定义矩形裁剪区域
2. 当对直线应用Cohen-Sutherland裁剪时，系统应使用区域编码高效地确定并裁剪矩形窗口内的线段
3. 当对直线应用中点分割裁剪时，系统应递归细分线段以确定裁剪矩形内的可见部分
4. 当执行直线裁剪时，系统应移除裁剪区域外的线段并保留区域内的线段
5. 当应用直线裁剪时，系统应保持非直线图形对象不变且不受影响

#### 需求4: 多边形裁剪

**用户故事：** 作为学生/研究者，我希望能够使用高级算法在矩形区域内裁剪多边形，以便理解和验证复杂多边形裁剪算法。

##### 验收标准

1. 当用户选择多边形裁剪工具时，系统应允许用户通过鼠标拖拽定义矩形裁剪区域
2. 当应用Sutherland-Hodgman裁剪时，系统应依次对裁剪窗口的每条边进行多边形裁剪
3. 当应用Weiler-Atherton裁剪时，系统应处理复杂的多边形裁剪情况，包括多重交点和潜在孔洞
4. 当执行多边形裁剪时，系统应移除裁剪区域外的多边形部分并保留区域内的部分
5. 当应用多边形裁剪时，系统应保持非多边形图形对象不变且不受影响

#### 需求5: 用户界面

**用户故事：** 作为学生/研究者，我希望有一个包含菜单项和工具栏按钮的直观界面，以便轻松访问所有图形学实验功能。

##### 验收标准

1. 当应用程序启动时，系统应显示包含菜单栏和工具栏的主界面，其中包含所有必需的工具
2. 当用户点击菜单项或工具栏按钮时，系统应激活相应的工具或功能
3. 当工具处于活动状态时，系统应提供视觉反馈指示当前选中的工具
4. 当显示用户界面时，系统应逻辑地组织工具，将绘制工具、变换工具和裁剪工具分别分组
5. 当激活工具时，系统应更新鼠标光标以反映当前工具模式

#### 需求6: 图形学原理实现

**用户故事：** 作为图形学学习者，我希望系统能清晰展示算法实现细节，避免使用Unity内置图形API的"黑盒"操作。

##### 验收标准

1. 当实现图形算法时，系统应提供算法步骤的可视化展示
2. 当执行绘制操作时，系统应允许查看帧缓冲的实时状态
3. 当进行比较算法时，系统应能同时显示多种算法的处理过程和结果
4. 当渲染图形时，系统应提供性能统计信息（算法执行时间等）
5. 当应用变换时，系统应显示变换矩阵的计算过程
